{"version":3,"file":"index.esm.js","sources":["../src/BRQSmartPopup.jsx"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\r\n\r\nexport default function BRQSmartPopup({\r\n  api,\r\n  dataKey,\r\n  displayFields = [],\r\n  bindFields = {},\r\n}) {\r\n  const [data, setData] = useState([]);\r\n  const [show, setShow] = useState(false);\r\n  const [highlightIndex, setHighlightIndex] = useState(0);\r\n  const [position, setPosition] = useState({ top: 0, left: 0, width: 0 });\r\n  const [filterValue, setFilterValue] = useState(\"\");\r\n  const [activeField, setActiveField] = useState(\"\");\r\n  const popupRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    fetch(api)\r\n      .then((res) => res.json())\r\n      .then((json) => setData(json[dataKey] || []))\r\n      .catch(console.error);\r\n  }, [api, dataKey]);\r\n\r\n  useEffect(() => {\r\n    const listeners = [];\r\n\r\n    const handleKeyDown = (e) => {\r\n      if (!show) return;\r\n\r\n      if (e.key === \"ArrowDown\") {\r\n        e.preventDefault();\r\n        setHighlightIndex((prev) => (prev + 1) % filteredData.length);\r\n      } else if (e.key === \"ArrowUp\") {\r\n        e.preventDefault();\r\n        setHighlightIndex((prev) => (prev - 1 + filteredData.length) % filteredData.length);\r\n      } else if (e.key === \"Enter\") {\r\n        e.preventDefault();\r\n        fillForm(filteredData[highlightIndex]);\r\n      } else if (e.key === \"Escape\") {\r\n        setShow(false);\r\n      }\r\n    };\r\n\r\n    Object.entries(bindFields).forEach(([fieldPath, controlId]) => {\r\n      const input = document.getElementById(controlId);\r\n      if (!input) return;\r\n\r\n      const focusHandler = () => {\r\n        const rect = input.getBoundingClientRect();\r\n        setPosition({\r\n          top: rect.bottom + window.scrollY,\r\n          left: rect.left + window.scrollX,\r\n          width: rect.width,\r\n        });\r\n        setActiveField(fieldPath);\r\n        setFilterValue(input.value || \"\");\r\n        setShow(true);\r\n      };\r\n\r\n      const inputHandler = (e) => {\r\n        setFilterValue(e.target.value);\r\n      };\r\n\r\n      input.addEventListener(\"focus\", focusHandler);\r\n      input.addEventListener(\"keydown\", handleKeyDown);\r\n      input.addEventListener(\"input\", inputHandler);\r\n\r\n      listeners.push(() => {\r\n        input.removeEventListener(\"focus\", focusHandler);\r\n        input.removeEventListener(\"keydown\", handleKeyDown);\r\n        input.removeEventListener(\"input\", inputHandler);\r\n      });\r\n    });\r\n\r\n    const outsideClick = (e) => {\r\n      if (!popupRef.current?.contains(e.target)) {\r\n        setShow(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"mousedown\", outsideClick);\r\n\r\n    return () => {\r\n      listeners.forEach((off) => off());\r\n      document.removeEventListener(\"mousedown\", outsideClick);\r\n    };\r\n  }, [data, bindFields, show]);\r\n\r\n  const getValueByPath = (obj, path) => {\r\n    return path.split(\".\").reduce((acc, key) => acc?.[key], obj);\r\n  };\r\n\r\n  const fillForm = (item) => {\r\n    Object.entries(bindFields).forEach(([field, controlId]) => {\r\n      const input = document.getElementById(controlId);\r\n      const value = getValueByPath(item, field);\r\n      if (input && value !== undefined) {\r\n        input.value = value;\r\n        input.dispatchEvent(new Event(\"input\", { bubbles: true }));\r\n      }\r\n    });\r\n    setShow(false);\r\n  };\r\n\r\n  const filteredData = data.filter((item) => {\r\n    const value = getValueByPath(item, activeField);\r\n    return value?.toString().toLowerCase().includes(filterValue.toLowerCase());\r\n  });\r\n\r\n  if (!show) return null;\r\n\r\n  return (\r\n    <div\r\n      ref={popupRef}\r\n      style={{\r\n        position: \"fixed\",\r\n        top: position.top + 4,\r\n        left: position.left,\r\n        width: position.width,\r\n        zIndex: 9999,\r\n      }}\r\n      className=\"max-h-80 overflow-y-auto space-y-2 p-2 bg-white border border-gray-200 shadow rounded-xl\"\r\n    >\r\n      {filteredData.length === 0 && (\r\n        <div className=\"p-2 text-gray-500 text-sm\">No matches found.</div>\r\n      )}\r\n      {filteredData.map((item, index) => (\r\n        <div\r\n          key={index}\r\n          onClick={() => fillForm(item)}\r\n          className={`rounded-xl p-4 shadow cursor-pointer border transition ${\r\n            highlightIndex === index\r\n              ? \"bg-blue-100 border-blue-400\"\r\n              : \"bg-white hover:bg-gray-50 border-gray-200\"\r\n          }`}\r\n        >\r\n          {displayFields.map((field, i) => (\r\n            <div key={i} className=\"text-sm text-gray-700\">\r\n              <span className=\"font-semibold text-gray-800\">\r\n                {field.split(\".\").pop()}:\r\n              </span>{\" \"}\r\n              {getValueByPath(item, field)}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["BRQSmartPopup","_ref","api","dataKey","_ref$displayFields","displayFields","_ref$bindFields","bindFields","_useState2","_slicedToArray","useState","data","setData","_useState4","show","setShow","_useState6","highlightIndex","setHighlightIndex","_useState8","top","left","width","position","setPosition","_useState0","filterValue","setFilterValue","_useState10","activeField","setActiveField","popupRef","useRef","useEffect","fetch","then","res","json","console","error","listeners","handleKeyDown","e","key","preventDefault","prev","filteredData","length","fillForm","Object","entries","forEach","_ref2","_ref3","fieldPath","controlId","input","document","getElementById","focusHandler","rect","getBoundingClientRect","bottom","window","scrollY","scrollX","value","inputHandler","target","addEventListener","push","removeEventListener","outsideClick","_popupRef$current","current","contains","off","getValueByPath","obj","path","split","reduce","acc","item","_ref4","_ref5","field","undefined","dispatchEvent","Event","bubbles","filter","toString","toLowerCase","includes","React","createElement","ref","style","zIndex","className","map","index","onClick","concat","i","pop"],"mappings":"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"}