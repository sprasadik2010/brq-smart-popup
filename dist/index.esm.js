import e,{useState as t,useRef as n,useEffect as r}from"react";function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,a=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(o){var u=o.api,a=o.dataKey,l=o.displayFields,c=void 0===l?[]:l,d=o.bindFields,f=void 0===d?{}:d,s=i(t([]),2),v=s[0],m=s[1],p=i(t(!1),2),y=p[0],h=p[1],b=i(t(0),2),g=b[0],w=b[1],E=i(t({top:0,left:0,width:0}),2),x=E[0],L=E[1],k=i(t(""),2),A=k[0],j=k[1],I=i(t(""),2),N=I[0],S=I[1],C=n(null);r((function(){fetch(u).then((function(e){return e.json()})).then((function(e){return m(e[a]||[])})).catch(console.error)}),[u,a]),r((function(){var e=[],t=function(e){y&&("ArrowDown"===e.key?(e.preventDefault(),w((function(e){return(e+1)%B.length}))):"ArrowUp"===e.key?(e.preventDefault(),w((function(e){return(e-1+B.length)%B.length}))):"Enter"===e.key?(e.preventDefault(),D(B[g])):"Escape"===e.key&&h(!1))};Object.entries(f).forEach((function(n){var r=i(n,2),o=r[0],u=r[1],a=document.getElementById(u);if(a){var l=function(){var e=a.getBoundingClientRect();L({top:e.bottom+window.scrollY,left:e.left+window.scrollX,width:e.width}),S(o),j(a.value||""),h(!0)},c=function(e){j(e.target.value)};a.addEventListener("focus",l),a.addEventListener("keydown",t),a.addEventListener("input",c),e.push((function(){a.removeEventListener("focus",l),a.removeEventListener("keydown",t),a.removeEventListener("input",c)}))}}));var n=function(e){var t;null!==(t=C.current)&&void 0!==t&&t.contains(e.target)||h(!1)};return document.addEventListener("mousedown",n),function(){e.forEach((function(e){return e()})),document.removeEventListener("mousedown",n)}}),[v,f,y]);var O=function(e,t){return t.split(".").reduce((function(e,t){return null==e?void 0:e[t]}),e)},D=function(e){Object.entries(f).forEach((function(t){var n=i(t,2),r=n[0],o=n[1],u=document.getElementById(o),a=O(e,r);u&&void 0!==a&&(u.value=a,u.dispatchEvent(new Event("input",{bubbles:!0})))})),h(!1)},B=v.filter((function(e){var t=O(e,N);return null==t?void 0:t.toString().toLowerCase().includes(A.toLowerCase())}));return y?e.createElement("div",{ref:C,style:{position:"fixed",top:x.top+4,left:x.left,width:x.width,zIndex:9999},className:"max-h-80 overflow-y-auto space-y-2 p-2 bg-white border border-gray-200 shadow rounded-xl"},0===B.length&&e.createElement("div",{className:"p-2 text-gray-500 text-sm"},"No matches found."),B.map((function(t,n){return e.createElement("div",{key:n,onClick:function(){return D(t)},className:"rounded-xl p-4 shadow cursor-pointer border transition ".concat(g===n?"bg-blue-100 border-blue-400":"bg-white hover:bg-gray-50 border-gray-200")},c.map((function(n,r){return e.createElement("div",{key:r,className:"text-sm text-gray-700"},e.createElement("span",{className:"font-semibold text-gray-800"},n.split(".").pop(),":")," ",O(t,n))})))}))):null}export{u as BRQSmartPopup};
//# sourceMappingURL=index.esm.js.map
